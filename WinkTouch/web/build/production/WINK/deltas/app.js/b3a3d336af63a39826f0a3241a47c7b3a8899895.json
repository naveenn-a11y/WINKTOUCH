["function _988b59eaf703bfccdbb86f655f79faad7d0e6f23",50,27695,"console.log(\"JSON encode Date.\");",27745,55,"console.log(\"JSON encode String...\");if(Ext.isMSDate(o)){console.log(\"JSON encode String...as MSDate\");",27820,617111,"isKeyNull:function(a){if(a.get(\"id\")===0){return true}if(typeof a.get(\"id\")===\"string\"){if(a.get(\"id\").startsWith(\"ext-record\")){return true}}return false},getURLParameter:function(a){return decodeURIComponent((new RegExp(\"[?|&]\"+a+\"=([^&;]+?)(&|#|;|$)\").exec(location.search)||[\"\"])[1].replace(/\\+/g,\"%20\"))||null},setDefaultValues:function(a){if(a instanceof WINK.model.PatientInvoice){a.set(\"orderdate\",new Date());a.set(\"store_idstore\",WINK.Utilities.currentstore.get(\"id\"))}else{if(a instanceof WINK.model.PatientPayment){a.set(\"date\",new Date());a.set(\"store_idstore\",WINK.Utilities.currentstore.get(\"id\"));a.set(\"user_iduser\",WINK.Utilities.currentuser.get(\"id\"))}}},loginSuccess:function(a){WINK.Utilities.currentstore=Ext.create(\"WINK.model.Store\",{id:1});WINK.Utilities.currentuser=Ext.create(\"WINK.model.User\");console.log(\"Set logged In User:\"+a.responseText);WINK.Utilities.currentuser.set(Ext.JSON.decode(a.responseText));console.log(\"Set logged In User:\"+WINK.Utilities.currentuser.get(\"id\"))},loadAllRequiredStores:function(a){console.log(\"Utilities.loadAllRequiredStores()\");if(!WINK.Utilities.currentstore){console.log(\"Utilities.loadAllRequiredStores() ajax /users/me\");Ext.Ajax.request({scope:this",705600,35,"sers/me\",method:\"GET\",withCredentials:true,useDefaultXhrHeader:false,success:function(b){WINK.Utilities.loginSuccess(b);WINK.Utilities.loadAllRequiredStores(a)},failure:function(b){",719960,76,";document.location.href=\"#login\"},callback:function(c,d,b){}});return}if(!this.storesLoaded){console.log(\"Utilities.loadAllRequiredStores() loading stores\");",742110,47,719858,51,";Ext.create(\"WINK.store.TaxCodeStore\",{storeId:\"TaxCodeStore\",autoLoad:true});Ext.create(\"WINK.store.PaymentMethodStore\",{storeId:\"PaymentMethodForCurrentStore\",autoLoad:true,params:{store_idstore:WINK.Utilities.currentstore.get(\"id\")}});this.storesLoaded=true}console.log(\"Utilities.loadAllRequiredStores() done!\");if(a){a()}},getAccountId:function(){if(!WINK.Utilities.accountid){WINK.Utilities.accountid=WINK.Utilities.getURLParameter(\"accountid\")}return WINK.Utilities.accountid},getRestURL:function(){return\"https://server1.downloadwink.com",644995,1121,656183,99,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",656328,824,"null",657153,115,"null",647200,61,"ext",707135,40,646415,61,657434,145,"JobStatusWrapper",674846,41,"date\",type:\"date\",dateFormat:\"time\"},{name:\"statusid\",type:\"int\"},{name:\"status\",type:\"string",691051,32,"},{name:\"user\",type:\"string\"},{name:\"jobstatus_idjobstatus\",type:\"int\"},{name:\"reference\",type:\"string\"",667517,33,"JobStatus\",associatedName:\"fkjobstatus_idjobstatus\",foreignKey:\"jobstatus_idjobstatus",648592,35,"jobstatus_idjobstatus\",setterName:\"setFkjobstatus_idjobstatus\"}],hasMany:[",657506,38,"Wrapper",676144,36,"roduct",653600,78,"products\",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",690957,104,"usebarcod",647216,45,700432,47,684332,41,"ramebran",665616,41,"framemodel",650176,40,"frame",686780,46,"ramea",650176,40,"frameb",650176,40,"framee",665616,41,"framedbl",650176,40,"frame",684332,41,683824,880,"null",684705,1278,"null",685984,66,"null",686051,478,"null",686530,1975,"_",693199,50,"associationKey:\"patientinvoiceitems_",693230,34,674288,44,"_",693199,50,"associationKey:\"barcodes_",693230,34,688761,68,"_",693199,50,"associationKey:\"productretaildetails_",693230,34,688761,68,"_",693736,74,"associationKey:\"productretaildetails_",688843,114,"_",693969,70,"associationKey:\"productretaildetails_",688971,1829,651056,94,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",651196,52,"null",671612,60,"null",651310,56,"null",651367,136,"null",651504,85,"null",651590,83,"null",651674,83,"null",651758,83,"null",651842,83,"null",651926,211,"null",652138,157,"null",652296,1162,"_",673315,50,"associationKey:\"patientinvoiceitems_",653472,121,"BarcodeRespons",674845,42,671342,53,"storeInvento",709072,38,"entrepriseInvento",709072,38,"isInventory",686224,44,671739,45,667518,33,673104,349,653522,36,"Respons",676143,36,646116,116,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",646278,448,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",646772,272,"null",647045,51,"null",676349,52,"null",647150,172,"null",647323,77,"null",647401,864,"null",648266,1447,"_",649474,70,"associationKey:\"appointments_",649727,296,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",690957,53,681932,141,647424,43,703392,52,650358,162,684868,53,691598,43,"Appointment\",name:\"appointments_",649248,37,648957,49,"associationKey:\"appointments_",650608,104,"_",649241,44,649229,56,"associationKey:\"appointments_",649241,59,691728,80,704575,45,704624,45,650955,101,653593,95,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",690957,45,691598,43,"Store\",name:\"stores_",654830,50,"associationKey:\"stores_",653855,100,"_",654830,50,"associationKey:\"countrysubdivisions_",653855,55,"User\",name:\"users_",654830,50,"associationKey:\"users_",653855,55,"Patient\",name:\"patients_",654830,50,"associationKey:\"patients_",653855,55,662800,37,"_",654830,50,"associationKey:\"patientinvoices_",653855,55,"Supplier\",name:\"suppliers_",654830,50,"associationKey:\"suppliers_",653855,35,654382,245,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",666972,52,"null",690957,45,667518,32,701276,176,654382,92,655071,162,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",655279,66,"null",677664,52,"null",690957,104,647424,43,703392,44,672638,280,655870,313,657579,94,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",657719,55,"null",657775,1115,"null",658891,193,"null",659085,604,"30768867656",659700,235,"null",659936,57,"null",659994,1551,"null",661546,1076,"_",661662,56,"associationKey:\"patients_",661696,37,706221,58,"_",675598,50,"associationKey:\"patientpayments_",675629,34,652544,35,"\",name:\"patientinvoices_",675598,50,"associationKey:\"patientinvoices_",675629,34,648864,32,"\",name:\"appointments_",675598,50,"associationKey:\"appointments_",675629,34,710795,52,"_",675598,50,"associationKey:\"patientnotes_",675629,34,698159,74,"_",675598,50,"associationKey:\"patientpaperfilenumbers_",675629,34,691728,38,663245,1581,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",664872,59,"4,4,15,47,4",664943,54,659883,52,"null",665047,156,"null",691151,53,665257,131,"null",681823,109,655355,43,"null",665542,287,"null",665830,300,"4,4,15,47,4",666142,58,"null",666201,56,"null",666258,380,"null",666639,385,"null",700717,53,667078,45,"null",667124,52,"null",667177,102,"null",667280,56,"null",667337,179,"null},{name:\"isestimat",647216,45,"estimate",665118,36,667518,2313,"_",672704,78,"associationKey:\"patientpayments_",679296,48,674144,66,"_",672704,78,"associationKey:\"patientinvoiceitems_",679296,48,670021,66,"_",672704,78,"associationKey:\"invoiceattachements_",679296,48,691728,39,670188,797,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",655279,66,"null",671098,234,"null",651196,52,"null",671386,60,"null",681677,60,656459,51,"null",671559,113,"null",651310,56,"null",671730,52,"null",671783,66,"null",671850,44,"null",671895,533,"null",681823,109,672538,100,",{name:\"isestimat",647216,37,672638,1436,"_",674478,41,674076,53,"associationKey:\"patientpayments_",674478,57,710144,34,"Item\",name:\"patientinvoiceitems_",674224,49,673798,61,"associationKey:\"patientinvoiceitems_",674224,108,"_",651599,50,674334,62,"associationKey:\"barcodes_",651599,50,654272,36,"Barcode\",name:\"barcodes_",653135,49,652972,63,"associationKey:\"barcodes_",653135,49,691712,54,691808,50,674622,265,"modelid",674900,280,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",676349,52,"null",675279,46,"null",677664,52,"null",658650,53,"post",685679,32,"ew Date(2015,4,4,15,47,47)",691151,44,667518,217,680831,138,680591,46,679915,138,705440,55,676133,170,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",676349,52,659883,52,"null",676451,627,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,659883,52,"null",655279,66,"null",676349,52,"null",677293,54,"4,4,15,47,4",677359,153,"null",681677,60,701152,92,675327,51,"null",665592,75,677792,166,"null",677***REMOVED***,122,"null",700877,56,678138,307,"null",678446,62,"null",678509,69,"null",678579,70,"null",678650,74,"null},{name",680416,43,"type:\"int\",defaultValue:null",678800,115,"null",678916,100,672633,37,693357,167,672670,248,667550,185,679650,1937,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",690957,104,703392,95,701152,92,691195,311,682235,187,"_",679683,74,"associationKey:\"patientpayments_",679726,46,691728,130,670239,96,704575,45,704624,45,682798,265,"Catego",653598,80,"productcategories\",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",690957,707,"_",687552,82,"associationKey:\"products_",687552,35,654366,72,682926,34,682910,39,704575,45,704624,45,682798,181,689614,96,694173,36,"Category",676144,36,692305,117,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",651196,52,659883,52,"null",671280,52,"null",692623,192,"null",692816,86,"null",692903,64,"null",692968,115,"null",693084,1262,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",694392,895,"null",699772,56,695344,106,"null",695451,383,"null",695835,557,"4,4",696396,400,"null",696797,60,672633,37,701276,165,697056,458,"_",697101,54,"associationKey:\"stores_",697134,36,697564,44,"_",667760,42,"associationKey:\"patients_",697534,74,"_",662411,60,"associationKey:\"patients_",662447,39,706221,58,"_",667760,42,"associationKey:\"patientpayments_",697534,58,"Invoice\",name:\"patientinvoices_",667760,42,"associationKey:\"patientinvoices_",697534,58,"Invoice\",name:\"patientinvoices_",669392,58,"associationKey:\"patientinvoices_",698025,90,"_",667760,42,"associationKey:\"appointments_",697534,58,698187,46,"_",667760,42,"associationKey:\"patientpaperfilenumbers_",697534,52,688783,46,"_",667760,42,"associationKey:\"productretaildetails_",698359,1367,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",699772,1041,"null",700814,430,",{name:\"iscontactlenssuppli",682304,38,",{name:\"isframesuppli",682304,51,709552,214,"Store\",name:\"stores_",697295,66,"associationKey:\"stores_",701504,86,"_",687802,72,"associationKey:\"products_",701604,89,"_",688032,78,"associationKey:\"products_",688032,33,698144,45,"yment\",name:\"patientpayments_",680271,35,680136,49,"associationKey:\"patientpayments_",680271,35,674128,51,"\",name:\"patientinvoices_",668434,58,"associationKey:\"patientinvoices_",701950,96,"_",668636,58,"associationKey:\"patientinvoices_",668671,38,691728,80,"maincontac",692112,40,711066,444,702672,474,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",703192,728,"_",693551,50,"associationKey:\"patientinvoiceitems_",672976,34,703968,70,"_",693551,50,"associationKey:\"taxcodeeffectivedates_",672976,34,688761,68,"_",693551,50,"associationKey:\"productretaildetails_",672976,34,691728,38,704240,646,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",671280,52,"null",704985,657,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",705688,380,"_",688272,60,"associationKey:\"products_imag",680685,35,706121,38,"_",709518,32,706160,46,"associationKey:\"users_",709518,32,674128,44,"Payment\",name:\"patientpayments_",679915,50,"associationKey:\"patientpayments_",680686,34,706221,58,"_",680637,68,"associationKey:\"patientpayments_",706399,101,"_",679915,50,"associationKey:\"patientinvoices_",680686,34,670021,66,"_",679915,50,"associationKey:\"invoiceattachements_",680686,34,710795,52,"_",679915,50,"associationKey:\"patientnotes_",680686,34,691728,38,706800,181,",withCredentials:true,useDefaultXhrHeader:false,cors:true",676303,45,"null",683392,49,707076,1710,"null",681823,109,708896,204,"null",709101,688,"_",662041,60,"associationKey:\"patients_",662077,39,706221,58,"_",680855,38,"associationKey:\"patientpayments_",710223,86,"_",667926,46,"associationKey:\"patientinvoices_",710014,90,"_",668100,32,"associationKey:\"patientinvoices_salesrep",697936,75,"_",668834,54,"associationKey:\"patientinvoices_",710215,94,"_",669209,50,"associationKey:\"patientinvoices_docto",710222,87,"_",66***REMOVED***0,68,"associationKey:\"patientinvoices_",669630,43,674144,66,"_",671792,33,710540,45,"associationKey:\"patientinvoiceitems_",671792,33,698048,67,"_",648546,48,"associationKey:\"appointments_",648576,33,674288,44,"_",653229,58,"associationKey:\"barcodes_",653264,38,710795,52,"_",680855,38,"associationKey:\"patientnotes_",710861,1188,"model.ProductBrowseModel",674846,44,690957,53,671342,43,"null",684636,68,"null},{name:\"type\",type:\"int\"",667517,34,687518,256,673103,165,694173,36,"BrowseModel",713198,36,"roduct",714199,40,"false,data:[],model:\"WINK.model.Product\"",714062,72,"Product",714475,34,712049,596,",withCredentials:true,useDefaultXhrHeader:false",714061,73,712718,92,"],model:\"WINK.model.TaxCode\",",646160,52,"taxcodes\",withCredentials:true,useDefaultXhrHeader:false},sorters:[{property:\"cod",712670,48,712924,1137,",withCredentials:true,useDefaultXhrHeader:false",714061,334,",withCredentials:true,useDefaultXhrHeader:false",714061,81,714476,33,"store.JobStatusStore\",Ext.data.Store,{sortList",713281,34,713349,43,646160,52,"jobstatuss/forpatientinvoice\",withCredentials:true,useDefaultXhrHeader:false},model:\"WINK.model.JobStatusWrapper\",sorters:[",713338,35,"}},0,0,0,0,0,0,[WINK.store,\"JobStatus",714475,34,"store.PaymentMethod",712773,37,"],",679632,33,646160,52,"paymentmethods\",withCredentials:true,useDefaultXhrHeader:false",714061,73,"PaymentMethod",714475,205,"Id",714680,56,714672,55,"Record",714732,330,715092,394,"margin:\"5 5 5 5",715484,855,727977,32,716331,741,747236,38,"winkname:\"quickfind\",defaults:{labelWidth:\"35%",746862,35,"winkfile\",label:\"Wink File \",placeHolder:\"i,r,z,s\"},{xtype:\"textfield\",flex:1",747410,86,715453,33,"margin:\"5 5 5 5\",ui:\"action\",text:\"Open\",handler:function(a,b){console.log(\"Quickfind.handler()\");var c=a.up(\"fieldset[winkname=quickfind]\").down(\"textfield[name=winkfile]\").getValue();if(!c){return}c=c.toLowerCase();console.log(\"Quickfind:\"+c);if(c.startsWith(\"i\")||c.startsWith(\"z\")||c.startsWith(\"r\")){document.location.href=\"#\"+c}}",717067,1882,",\"\":\"goTo",718943,111,"openLogin:function(",737595,45,"LoginPanel())",719052,66,"goToLogi",719069,38,"login",719115,228,"scope:this",705600,35,"sers/me\",method:\"GET\",crossDomain:true,withCredentials:true,useDefaultXhrHeader:false",719398,97,"Id",719495,71,"WINK.Utilities.loginSuccess(c);WINK.Utilities.loadAllRequiredStores();",719566,163,719082,35,748327,79,719960,697,"before:{openPatient:\"beforeRoute\",openInvoice:\"beforeRoute\",openFindPatient:\"beforeRoute\",openNewPatient:\"beforeRoute\",openQuicksale:\"beforeRoute\"",720655,45,"\"invoice/:invoiceid\":\"openInvoice",720698,88,",\"i:invoiceid\":\"openInvoice\",\"z:patientid\":\"openPatient",720785,323,"beforeRoute:function(a){console.log(\"MenuController.beforeRoute()\");",721132,34,"Utilities.loadAllRequiredStores(function(){console.log(\"MenuController.beforeRoute() callback\"",645758,33,"resume()})},openInvoice:function(b){var a=this;WINK.model.PatientInvoice.load(b,{success:function(d){console.log(\"loaded \"+d.get(\"id\"));if(d.get(\"patient_idpatient\")&&d.get(\"patient_idpatient\")>0){a.openPatientInvoice(d.get(\"patient_idpatient\"),b)}else{var c",751032,38,"a",731013,33,";c.loadPatientInvoice(d)}}})},openPatientInvoice:function(b,a){this.openPatient(b",721105,32,721166,601,"){console.log(\"MenuController.openQuicksale()\"",748858,48,"WINK.Utilities.setDefaultValues(b);",721774,80,";a.loadPatientInvoice(b",721853,103,"){var a",721968,73,"a",722042,417,"JobStatusPanel\",Ext.Panel,{getStore:function(){if(!this.winkStore){this.winkStore=Ext.create(\"WINK.store.JobStatusStore\");this.down(\"dataview\").setStore(this.winkStore)}return this.winkStore},loadStatusOnce:function(){console.log(\"JobStatusPanel loadStatusOnce()\");if(!this.alreadyLoaded){this.alreadyLoaded=true;this.setMasked(true);var b=this.up(\"InvoicePanel\");var a=b.patientinvoice;console.log(\"Jobstatuspanel loadStatusOnce idpatientinvoice \"+a.get(\"id\"));this.getStore().load({scope:this,params:{idpatientinvoice:a.get(\"id\")},callback:function(d,c,e){console.log(\"loaded job status records\");this.setMasked(false)}})}},",727182,36,751785,46,"false,itemTpl:'{date:date(\"Y M D h:m\")} ({reference}) {user} {status} {comment}'",752493,42,"}}}]}},0,[\"jobstatus",279247,40,",\"jobstatus",620927,39,"panel:true,jobstatuspanel:true},[\"widget.jobstatuspanel\"],0,[WINK.view,\"JobStatu",727392,40,"PhoneField\",Ext.field.Text,{config:{",313931,33,"l\"}}},0,[\"phone",318464,42,"phone",580718,51,"honefield:true},[\"widget.phonefield\"],0,[WINK.view,\"Phone",741629,40,"riceField\",Ext.form.Number,{apply",575408,32,578010,153,".toFixed(2);return(isNaN(b))?\"\":b},config:{component:{xtype:\"input\",type:\"number\"},stepValue:0.01}},0,[\"price",318464,42,"numberfield\",\"price",578478,66,",pricefield:true},[\"widget.pricefield\"],0,[WINK.view,\"Price",741629,39,"IntField\",Ext.form.Number,{applyValue1",577983,167,"Math.round(b);b=(isNaN(b))?\"\":b;return b},setValue1:function(a){var b=this.applyValue1(a);console.log(a+\" formattedTo  \"+b);this.superclass.setValue.call(this,b)},parseStringToFloat:function(a){a=a.replace(/[^0-9.]/g,\"\");return parseFloat(a)},config:{component:{xtype:\"input\",type:\"number\"},value:0",722929,40,"},0,[\"in",732127,43,"numberfield\",\"int",578478,66,",intfield:true},[\"widget.intfield\"],0,[WINK.view,\"Int",741629,39,731137,586,"InvoiceItemPanel\",Ext.form.Panel,{deleteItem:function(){var a=this.up(\"InvoicePanel\");a.deleteItem(this)},loadItem:function(a){this.winkloading=true;console.log(\"InvoiceItemPanel.loadItem item.unitprice:\"+a.get(\"unitprice\"));this.setRecord(a);var b=this.down(\"label[winkname=productname]\");a.getFkproduct_idproduct({callback:function(d,c){b.setHtml(d.get(\"name\"))}});this.updateTotal();this.winkloading=false},getSubtotal:function(){var c=this.down(\"numberfield[name=qty]\");var b=this.down(\"numberfield[name=prediscount_unitprice]\");var d=this.down(\"numberfield[name=discountamount]\");var a=((c.getValue()*b.getValue())-d.getValue());console.log(\"invoice item getSubtTotal():\"+a);return a},showMore:function(){this.setHeight(160),",727631,41,"details]\").show()},showLess:function(){this.setHeight(80),",727631,41,"details]\").hide()},getInvoiceDate:function(){var a=this.up(\"InvoicePanel\");return a.getOrderDate()},getTaxCodeRate:function(){",742214,34,"taxcode_idtaxcode]\");var d=a.getRecord();if(!d){return null}ratesStore=d.taxcodeeffectivedates_taxcode_idtaxcode();var c=null;var b=this.getInvoiceDate();console.log(\"invoice date: \"+b);ratesStore.each(function(g,f,h){console.log(\"looking for taxcode rate: \"+g.get(\"effectivedate\"));var i=g.get(\"effectivedate\");var e=false;if(!i){e=true}else{if(i<=b){e=true}}if(e){console.log(\"found valid tax code rate\");if(!c){c=g}else{if(c.get(\"effectivedate\")<i){c=g}}}else{console.log(\"found invalid tax code rate\")}},this);return c},recalculateTax:function(){if(this.winkloading){return}console.log(\"InvoiceItemPanel.recalculateTax()\");var d=this.down(\"numberfield[name=tax1amount]\");var f=this.down(\"numberfield[name=tax2amount]\");var a=this.getTaxCodeRate();if(!a){console.log(\"InvoiceItemPanel.recalculateTax() noFoundTaxRate\");d.setValue(0);f.setValue(0)}else{console.log(\"InvoiceItemPanel.recalculateTax()  FoundTaxRate \"+a.get(\"tax1percentage\")+\" \"+a.get(\"tax2percentage\"));var b=this.down(\"numberfield[name=qty]\");var c=this.down(\"numberfield[name=prediscount_unitprice]\");var e=this.down(\"numberfield[name=discountamount]\");var g=((b.getValue()*c.getValue())-e.getValue());var i=g*a.get(\"tax1percentage\")/100;if(a.get(\"piggyback\")){g+=i}var h=g*a.get(\"tax2percentage\")/100;d.setValue(i);f.setValue(h)}},getTax1:function(){var a=this.down(\"numberfield[name=tax1amount]\");return a.getValue()},getTax2:function(){var a=this.down(\"numberfield[name=tax2amount]\");return a.getValue()},getTax1Name:function(){",742214,34,"taxcode_idtaxcode]\");var b=a.getRecord();if(!b){return null}return b.get(\"tax1name\")},getTax2Name:function(){",742214,34,"taxcode_idtaxcode]\");var b=a.getRecord();if(!b){return null}return b.get(\"tax2name\")},updateModel:function(){var b=this.getRecord();var a=this.getValues();console.log(\"Invoice Item:\"+b);console.log(a);b.set(a);return b},updateTotal:function(){var a=this.down(\"numberfield[name=subtotal_beforetax]\");var b=this.up(\"InvoicePanel\");a.setValue(this.getSubtotal());if(b){b.updateSummary()}},",722492,51,"8",722544,83,"vbox\"},items:[{xtype:\"label\",baseCls:\"Product Name\",html:\"",722717,36,"15px; font-family:\"open sans\"',winkname:\"productname\",height:20},",732421,46,"center\"},winkname:\"invoiceitemsummary\",items:[{xtype:\"label\",flex:1},{xtype:\"intfield\",name:\"product_idproduct\",hidden:true},{xtype:\"int",722809,111,"name:\"qty\",listeners:{change:function(a,c,b){a.up(\"invoiceitempanel\").updateTotal()}}},{xtype:\"price",722809,117,"0",723111,64,"name:\"prediscount_unitprice\",listeners:{change:function(a,c,b){a.up(\"invoiceitempanel\").updateTotal()}}",723189,160,",name:\"taxcode_idtaxcode\",listeners:{change:function(a,c,b){arguments[0].up(\"invoiceitempanel\").recalculateTax()}}},{xtype:\"price",722809,117,"0",723111,64,"name:\"discountamount\",listeners:{change:function(a,c,b){a.up(\"invoiceitempanel\").updateTotal()}}},{xtype:\"price",723365,125,"0",723500,80,",name:\"subtotal_beforetax\"",723580,83,",handler:function(a){a.up(\"invoiceitempanel\").deleteItem()}}]},",732421,46,"center\"},winkname:\"invoiceitemdetails\",hidden:true,items:[{xtype:\"pricefield\",name:\"tax1amount\",inputCls:\"inputAmount\",value:0,listeners:{change:function(a,c,b){a.up(\"invoiceitempanel\").updateTotal()}}},{xtype:\"pricefield\",name:\"tax2amount\",inputCls:\"inputAmount\",value:0,listeners:{change:function(a,c,b){a.up(\"invoiceitempanel\").updateTotal()}}}]}]}},0,[\"invoiceitem",279247,40,",\"formpanel\",\"invoiceitem",620927,39,"panel:true,formpanel:true,invoiceitempanel:true},[\"widget.invoiceitempanel",723943,87,727450,48,"setRecord(a)},updateSummary:function(){var m=this.down(\"label[name=subtotal]\");var g=this.down(\"label[name=tax1]\");var k=this.down(\"label[name=tax2]\");var p=this.down(\"label[name=tax1name]\");var d=this.down(\"label[name=tax2name]\");var a=this.down(\"label[name=total]\");var l=this.down(\"label[name=insuranceportion]\");var h=this.down(\"label[name=patientportion]\");var e=this.down(\"label[name=payments]\");var b=this.down(\"label[name=balance]\");var c=this.up(\"InvoicePanel\");var j=c.getSubtotal();var q=c.getTax1();var o=c.getTax2();var i=j+q+o;var f=c.getInsurancePortion();var n=c.getPatientPaymentsTotal();m.setHtml(j.toFixed(2));g.setHtml(q.toFixed(2));k.setHtml(o.toFixed(2));a.setHtml(i.toFixed(2));l.setHtml(f.toFixed(2));h.setHtml((i-f).toFixed(2));e.setHtml(n.toFixed(2));b.setHtml((i-f-n).toFixed(2));p.setHtml(c.getTax1Name());d.setHtml(c.getTax2Name())},",724041,100,"2",724142,81,"selectfield\",store:\"LocationStore\",margin:\"5 0 5 0\",label:\"\",labelWidth:\"0%\",readOnly:true,valueField:\"id\",displayField:\"name\",name:\"store_idstore\",title:\"Store",724416,52,"O\",labelWidth:\"20%\",readOnly:true,name:\"orderdate",724416,52,"P\",labelWidth:\"20%\",placeHolder:\"Not Promissed\",name:\"promisseddate",724416,53,"\",labelWidth:\"20%\",placeHolder:\"Open\",name:\"delivereddate\"",724991,149,724669,56,"0.00\",style:\"color: darkgrey\",name:\"subtotal",725456,152,"Tax 1\",style:\"color: darkgrey\",name:\"tax1name\"},{xtype:\"label\",html:\"0.00\",style:\"color: darkgrey\",name:\"tax1",725456,152,"Tax 2\",style:\"color: darkgrey\",name:\"tax2name\"},{xtype:\"label\",html:\"0.00\",style:\"color: darkgrey\",name:\"tax2",725456,152,725374,53,"0.00\",style:\"color: darkgrey\",name:\"total",725456,209,"0.00\",style:\"color: darkgrey\",name:\"insuranceportion",725456,152,"Patient",724911,48,"0.00\",style:\"color: darkgrey\",name:\"patientportion",725456,152,"Payments",724911,48,"0.00\",style:\"color: darkgrey\",name:\"payments",726167,196,"0.00\",style:\"color: black\",name:\"balance",726556,38,726427,70,"90,text:\"Pay\",handler:function(a){a.up(\"InvoicePanel\").pay()}},{xtype:\"button\",width:90,text:\"Deliver\",handler:function(a){a.up(\"InvoicePanel\").deliver()}",726557,106,"90,text:\"Print\",handler:function(a){a.up(\"InvoicePanel\").print()}",726679,36,"90,text:\"Email\",handler:function(a){a.up(\"InvoicePanel\").email()}",726557,37,726768,70,"90,text:\"Save\",handler:function(a){a.up(\"InvoicePanel\").save()}",726853,37,"90,text:\"Delete\",handler:function(a){a.up(\"InvoicePanel\").deleteInvoice()}",726907,76,"panel\",\"formpanel",726980,51,730498,33,727038,102,"AddPaymentPanel\",Ext.form.Panel,{addPayment:function(){",748860,36,"Payment\");b.set(this.getValues());",721774,37,"ymentPanel\");a.loadItem(b);this.patientinvoicepanel.addPayment(a);Ext.Viewport.remove(this)},setPatientInvoicePanel",727480,32,"panel=a;this.down(\"pricefield[name=amount]\").setValue(a.getPatientBalance())},config:{centered:true,fullscreen:false,layout:\"fit\",modal:true,hideOnMaskTap:true,scrollable:false,width:600,height:300",718022,46,"Add Payment\"",743439,46,715048,114,"Method",744463,43,"PaymentMethodForCurrentStor",744720,34,677451,36,"},{xtype:\"textfield\",label:\"Description\",required:false,name:\"description\"},{xtype:\"pricefield\",label:\"Amount\",name:\"amount\",required",715447,39,"ui:\"action\",text:\"Add Payment\",handler:function(a){a.up(\"addpaymentpanel\").addPayment()}}]}]}]}},0,[\"addpayment",279247,40,",\"formpanel\",\"addpayment",620927,39,"panel:true,formpanel:true,addpaymentpanel:true},[\"widget.addpaymentpanel\"],0,[WINK.view,\"AddPayment",737776,41,"oductSearchResultsPanel\",Ext.Panel,{browse:function(){var a=Ext.create(\"Ext.data.TreeStore\",{model:\"WINK.model.ProductBrowseModel\",defaultRootProperty:\"items\",root:{},proxy:{type:\"ajax",694304,35,"products/browse\",withCredentials:true,useDefaultXhrHeader:false,cors:true}});this.down(\"nestedlist[winkname=browseproduct]\").setStore(a);this.setActiveItem(this.down(\"nestedlist[winkname=browseproduct]\"))},getStore:function(){if(!this.winkProductStore){this.winkProductStore=Ext.create(\"WINK.store.BarcodeResponseStore\");this.down(\"dataview\").setStore(this.winkProductStore)}return this.winkProductStore},selectProduct:function(b,a){this.setMasked(true);b.productretaildetails_product_idproduct()",749505,36,"d,c,e){console.log(\"Loaded product retails pricing \");this.up(\"InvoicePanel\").addProductToInvoice(b,a);this.setMasked(false)}})},find",721119,42,"this.setMasked(true);this.setActiveItem(this.down(\"list[winkname=searchproduct]\"));this.getStore().setData([]",748110,54,"roducts/find/\"+encodeURIComponent(a),method:\"GET\",scope:this,withCredentials:true,useDefaultXhrHeader:false,success:function(d){console.log(\"product lookup success \"+d.responseText);var b=Ext.JSON.decode(d.responseText);console.log(\"product lookup success products returned:\"+b.length);if(b.length===0){Ext.Msg.alert(\"Product Lookup\",\"No Products Found For:\"+a,Ext.emptyFn)}else{if(b.length===1){console.log(\"product lookup returned 1 product\");var e=Ext.create(\"WINK.model.BarcodeResponse\",b[0]);var g=e.getFkproduct_idproduct();var c=e.getFkbarcode_idbarcode();console.log(\"product:\"+g.get(\"id\")+\" \"+g.get(\"name\"));this.selectProduct(g,c)}else{for(var f=0;f<b.length;f++){var e=Ext.create(\"WINK.model.BarcodeResponse\",b[f]);this.getStore().add(e)}this.getStore().sortList()}}WINK.Utilities.hideWorking();this.unmask()},failure:function(b",748375,60,"b,\"Product Lookup\")},callback:function(c,d,b){}})},config:{layout:\"card\",cls:\"productListDataViewContainer\",items:[{xtype:\"list\",winkname:\"searchproduct",752361,56,"fkproduct_idproduct.name}",752492,43,"}},onItemDisclosure:function(c,d,b){var e=c.getFkproduct_idproduct();var a=c.getFkbarcode_idbarcode();d.up(\"productsearchresultspanel\").selectProduct(e,a)}},{xtype:\"nestedlist\",winkname:\"browseproduct\",displayField:\"name",752492,43,"},leafitemtap:function(c,e,a,b){var b=e.getStore().getAt(a);if(b.get(\"type\")===2){var d=b.getFkproduct_idproduct();e.up(\"productsearchresultspanel\").selectProduct(d",505877,38,"'<div class=\"item-title\">{name}</div><tpl if=\"leaf === true\"><div class=\"x-list-disclosure\"></div></tpl>'}}]}},0,[\"productsearchresults",279247,40,",\"productsearchresults",620927,39,"panel:true,productsearchresultspanel:true},[\"widget.productsearchresultspanel\"]",727358,104,"deliver:function(){this.getInvoiceSummary().down(\"datepickerfield[name=delivereddate]\").setValue(new Date());this.save()},isDirty:function(){},save:function(){this.setMasked(true);this.updateInvoiceModel();var d=this;var a=this.patientinvoice;var b=this.patientinvoice.get(\"id\");var c=d.up(\"PatientHistoryPanel\");console.info(\"InvoicePanel.save() before Ajax, historyPanel:\"+c+\" \"+this.patientinvoice.get(\"delivereddate\"));this.patientinvoice.save({success:function(e){console.info(\"save invoice success\");console.info(\"historyPanel:\"+c);var f=a.get(\"id\");console.info(b+\" vs \"+a.get(\"id\"));var g=Ext.ModelManager.getModel(\"WINK.model.PatientInvoice\");console.info(\"calling load:\"+g+\" \"+f);g.load(f,{scope:this,failure:function(h,i){console.info(\"InvoicePanel.save().PatientInvoice.load().failure()\")},success:function(i,j){var h=i;console.info(\"InvoicePanel.save().PatientInvoice.load().success()\");console.info(\"InvoicePanel.save().PatientInvoice.load():\"+f+\" \"+h.get(\"id\"));if(f!==b){console.info(b+\" !== \"+f);if(c){console.info(\"calling historyPanel.updateInvoiceId()\");c.updateInvoiceId(b,h)}}else{console.info(b+\" = \"+f)}console.info(document.location.href);if(document.location.href.indexOf(\"#newquicksale\")>=0){document.location.href=\"#invoice/\"+h.get(\"id\")}else{d.loadPatientInvoice(h);if(c){console.info(\"historyPanel.invoiceSaved()\");c.invoiceSaved(d)}}}})},failure:function(e){},callback:function(f,g,e){d.setMasked(false)}})},pay:function(){var a=Ext.create(\"WINK.view.AddPaymentPanel\");Ext.Viewport.add(a);a.setPatientInvoicePanel(this)},addPayment:function(b){var a=this.patientinvoice;if(!this.payments){this.payments=[]}this.payments[this.payments.length]=b;this.getPaymentsContainer().add(b);this.updateNoPaymentsPanel();this.updateSummary();this.save()},deleteInvoice:function(){alert(\"not implemented\")},email:function(){this.save()},print:function(){this.save()},isFullyLoaded:function(){if(!this.isPaymentsLoaded){return false}if(!this.isInvoiceItemsLoaded){return false}return this.isPaymentsLoaded&&this.isInvoiceItemsLoaded},updatePaymentsModel:function(){var a=[];for(var b=0;b<this.payments.length;b++){console.log(\"updatePaymentsModel() \"+b);a.push(this.payments[b].updateModel())}return a},updateItemsModel:function(){var a=[];for(var b=0;b<this.invoiceitems.length;b++){console.log(\"InvoicePanel.updateItemsModel() i=\"+b);a.push(this.invoiceitems[b].updateModel())}console.log(\"InvoicePanel.updateItemsModel() length \"+a.length);return a},updateInvoiceModel:function(){console.log(\"InvoicePanel.updateInvoiceModel()\");var a=this.getInvoiceSummary().getValues();for(var b=0;b<a.length;b++){console.log(b+\" \"+a[0])}this.patientinvoice.set(a);var d=this.patientinvoice.patientpayments_patientinvoice_idpatientinvoice();var c=this.patientinvoice.patientinvoiceitems_patientinvoice_idpatientinvoice();d.setData(this.updatePaymentsModel());c.setData(this.updateItemsModel());console.log(\"InvoicePanel.updateInvoiceModel() count of items\"+c.getCount());c.each(function(e){console.log(\"InvoicePanel.updateInvoiceModel invoiceItemsStore.each():\"+e)});return this.patientinvoice},loadPatientInvoice",750468,34,"this.patientinvoice=b;console.log(\"InvoicePanel.loadPanelInvoice() \"+b.get(\"id\"));this.isPaymentsLoaded=false;this.isInvoiceItemsLoaded=false;var e",727520,66,";this.clearInvoicePaymentsContainer();if(!b.get(\"patient_idpatient\")||b.get(\"patient_idpatient\")===0){if(!b.get(\"delivereddate\")){b.set(\"delivereddate\",b.get(\"orderdate\"))}this.getInvoiceSummary().down(\"datepickerfield[name=delivereddate]\").hide();this.getInvoiceSummary().down(\"datepickerfield[name=promisseddate]\").hide();this.down(\"segmentedbutton[winkname=addworksheetbuttons]\").hide()}else{this.getInvoiceSummary().down(\"datepickerfield[name=delivereddate]\").show();this.getInvoiceSummary().down(\"datepickerfield[name=promisseddate]\").show();this.down(\"segmentedbutton[winkname=addworksheetbuttons]\").show()}this.setRecord(b);var c=this.down(\"label[name=id]\");if(WINK.Utilities.isKeyNull(b)){c.setHtml(\"New Invoice\")}else{c.setHtml(\"i\"+b.get(\"id\"))}this.getInvoiceSummary().loadPatientInvoice(b);var d=b.patientinvoiceitems_patientinvoice_idpatientinvoice();var a=b.patientpayments_patientinvoice_idpatientinvoice();d",749505,36,"g,f,h){console.log(\"Loaded invoice items \");this.itemsLoaded()}});a",749505,36,"g,f,h){console.log(\"Loaded invoice payments \");this.paymentsLoaded()}});this.unmask()},itemsLoaded:function(){",727553,33,";var a=this.patientinvoice;var c",727520,33,"var b=a.patientinvoiceitems_patientinvoice_idpatientinvoice();b.each(function(f,d,e){console.log(\"InvoicePanel.itemsLoaded() patientinvoiceitemsStore.each() \"+d);var g=Ext.create(\"WINK.view.InvoiceItemPanel\");if(!this.invoiceitems){this.invoiceitems=[]}this.invoiceitems[d]=g;c.add(g);g.loadItem(f)},this);this.updateNoItemsPanel();this.isInvoiceItemsLoaded=true;if(this.isFullyLoaded()){this.unmask()}},updateNoItemsPanel:function(){if(this.invoiceitems){if(this.invoiceitems.length===0){if(this.noItemsPanelAdded){return}",727725,32,"add(this.getNoItemsPanel());this.noItemsPanelAdded=true}else{if(this.noItemsPanelAdded",727723,40,"(this.getNoItemsPanel())}this.noItemsPanel=null;this.noItemsPanelAdded=false}}},updateNoPaymentsPanel:function(){if(this.payments){if(this.payments.length===0){if(this.noPaymentsPanelAdded){return}this.getPaymentsContainer().add(this.getNoPaymentsPanel());this.noPaymentsPanelAdded=true}else{if(this.noPaymentsPanelAdded){this.getPaymentsContainer().remove(this.getNoPaymentsPanel())}this.noPaymentsPanel=null;this.noPaymentsPanelAdded=false}}},getNoPaymentsPanel:function(){if(!this.noPaymentsPanel){this.noPaymentsPanel",751032,32,"ymentPanel\",{items:[{xtype:\"label\",html:\"No Payments Received\",margin:\"0 5 0 5\",style:'font-size:15px; font-family:\"open sans\"',height:20}]})}return this.noPaymentsPanel},getNoItemsPanel:function(){if(!this.noItemsPanel){this.noItemsPanel",751032,32,"ymentPanel\",{items:[{xtype:\"label\",html:\"No Items Sold. Look for products to add to the invoice.\",margin:\"0 5 0 5\",style:'font-size:15px; font-family:\"open sans\"',height:20}]})}return this.noItemsPanel},paymentsLoaded:function(){this.clearInvoicePaymentsContainer();var b=this.patientinvoice;var c=this.getPaymentsContainer();var a=b.patientpayments_patientinvoice_idpatientinvoice();a.each(function(g,e,f){var d",751032,32,"ymentPanel\");if(!this.payments){this.payments=[]}this.payments[e]=d;c.add(d);d.loadItem(g)},this);this.updateNoPaymentsPanel();this.isPaymentsLoaded=true;if(this.isFullyLoaded()){this.unmask()}},getInvoiceSummary:function(){return this.down(\"InvoiceSummary\")},getPayment",727602,66,"paymentscontainer]\")},get",727692,33,727624,154,";this.invoiceitems=[];this.noItemsPanel=null;this.noItemsPanelAdded=false},clearInvoicePaymentsContainer:function(){this.getPayment",727744,34,";this.payments=[];this.noPaymentsPanel=null;this.noPaymentsPanelAdded=false},deletePayment:function(b){for(var a=0;a<this.payments.length;a++){if(this.payments[a]===b){this.payments.splice(a,1);this.getPaymentsContainer().remove(b);break}}this.updateNoPaymentsPanel();this.updateSummary()},deleteItem:function(b){for(var a=0;a<this.invoiceitems.length;a++){if(this.invoiceitems[a]===b){this.invoiceitems.splice(a,1);",727725,38,"(b);break}}this.updateNoItemsPanel();this.updateSummary()},getListedUnitPrice:function(b,c){var a=0;var d=this.getProductRetailDetails(b,c);if(d){a=d.get(\"retailpriceto\")}console.log(\"returning:\"+a);return a},getCurrentStoreId:function(){var a=this.getInvoiceSummary().down(\"selectfield[name=store_idstore]\").getRecord();return a.get(\"id\")},getOrderDate:function(){return this.getInvoiceSummary().down(\"datepickerfield[name=orderdate]\").getValue()},getProductRetailDetails:function(b,c){c=c||this.getCurrentStoreId();var d=null;var a=b.productretaildetails_product_idproduct();a.each(function(e,f,g){console.log(\"lookgin for retail price:\"+e.get(\"store_idstore\")+\" \"+e.get(\"retailpriceto\"));if((e.get(\"store_idstore\")==null)||(e.get(\"store_idstore\")===0)||(e.get(\"store_idstore\")===c)){d=e;if(e.get(\"store_idstore\")===c){return}}},this);return d},getTaxCodeId:function(b){var a=this.getProductRetailDetails(b);if(!a){return null}return a.get(\"taxcode_idtaxcode\")},addProductToInvoice:function(f,b){var d=this.getListedUnitPrice(f,this.getCurrentStoreId());console.log(\"default price is:\"+d);var h",727520,33,"var c=null;if(b){c=b.get(\"id\")}var e=this.getTaxCodeId(f);console.log(\"Tax Code ID is:\"+e",748904,38,"InvoiceItem\",{qty:1,product_idproduct:f.get(\"id\"),fkproduct_idproduct:f,prediscount_unitprice:d,barcode_idbarcode:c,fkbarcode:b,taxcode_idtaxcode:e});console.log(\"newInvoiceItem unit price is:\"+a.get(\"prediscount_unitprice\"));var g=Ext.create(\"WINK.view.InvoiceItemPanel\");if(!this.invoiceitems){this.invoiceitems=[]}this.invoiceitems[this.invoiceitems.length]=g;this.getInvoiceContainer().setActiveItem(h);h.add(g);g.loadItem(a);g.recalculateTax();this.updateNoItemsPanel();this.down(\"textfield[winkname=searchProductField]\").setValue(\"\")},getSubtotal:function(){var a=0;if(this.invoiceitems){for(var b=0;b<this.invoiceitems.length;b++){console.log(\"invoicePanel getSubtTotal():\"+b+\" of \"+this.invoiceitems.length+\" = \"+a);a+=this.invoiceitems[b].getSubtotal()}}console.log(\"invoicePanel getSubtTotal() sum \"+a);return a},getTax1:function(){var b=0;if(this.invoiceitems){for(var a=0;a<this.invoiceitems.length;a++){b+=this.invoiceitems[a].getTax1()}}return b},getTax2:function(){var b=0;if(this.invoiceitems){for(var a=0;a<this.invoiceitems.length;a++){b+=this.invoiceitems[a].getTax2()}}return b},getInsurancePortion:function(){var a=0;return a},getPatientBalance:function(){var a=this.getSubtotal();var d=this.getTax1();var b=this.getTax2();var e=a+d+b;var c=this.getInsurancePortion();var f=this.getPatientPaymentsTotal();return e-c-f},getPatientPaymentsTotal:function(){var b=0;if(this.payments){for(var a=0;a<this.payments.length;a++){b+=this.payments[a].getAmount()}}return b},getTax1Name:function(){var b=null;if(this.invoiceitems){for(var c=0;c<this.invoiceitems.length;c++){var a=this.invoiceitems[c].getTax1Name();if(a&&a.trim().length>0){if(b&&b.length>0){if(b.toUpperCase()===a.trim().toUpperCase()){}else{b=\"Tax 1\";break}}else{b=a.trim()}}}}return b||\"Tax 1\"},getTax2Name:function(){var b=null;if(this.invoiceitems){for(var c=0;c<this.invoiceitems.length;c++){var a=this.invoiceitems[c].getTax2Name();if(a&&a.trim().length>0){if(b&&b.length>0){if(b.toUpperCase()===a.trim().toUpperCase()){}else{b=\"Tax 2\";break}}else{b=a.trim()}}}}return b||\"Tax 2\"},updateSummary:function(){this.getInvoiceSummary().updateSummary()},getInvoice",727603,65,"container]\")},getSearchProductsContainer:function(){if(!this.searchProductsContainer){this.searchProductsContainer",728656,49,",{title:\"Product Seach\",iconCls:\"info\"})}this.getInvoiceContainer().setActiveItem(this.searchProductsContainer);return this.searchProductsContainer},searchProducts:function(){var b=this.down(\"textfield[winkname=searchProductField]\");var a=b.getValue();if((a!=null)&&(a.trim().length>0)){console.log(\"looking for products with \"+b);this.getSearchProductsContainer().find(a)}},browseProducts:function(){this.getSearchProductsContainer().browse(",727777,72,"container\",flex:1",724144,40,727938,178,729001,52,"label\",name:\"id\",readOnly:true,html:\"\",margin:\"0 2 0 20\",style:'font-size:15px; font-family:\"open sans\"'",729327,35,728149,338,",winkname:\"searchProductField",728486,108,"a){a.up(\"InvoicePanel\").searchProducts(",728757,105,"Browse\",handler:function(a){a.up(\"InvoicePanel\").browseProducts()}",728872,233,"winkname:\"addworksheetbuttons\"",729104,55,",handler:function(a,b){a.up(\"InvoicePanel\").newRxWorksheet()}},{xtype:\"button\",text:\"+ CL\",hidden:true",726557,39,729227,61,",handler:function(){function b(c){alert(\"Success: \"+c)}function a(c){alert(\"Failed: \"+c)}navigator.camera.getPicture(b,a,{quality:50,destinationType:navigator.camera.DestinationType.FILE_URI,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY})}",729288,35,",hidden:true",729323,139,"winkname:\"invoiceitemsheader",725103,37,"\",margin:\"5 2 0",729524,195,"Discount",729614,52,"otal",729614,51,729775,50,729350,112,"winkname:\"paymentsheader\",hidden:true,items:[{xtype:\"label\",html:\"Date\",margin:\"5 2 0 2\",width:150},{xtype:\"label\",html:\"Method\",margin:\"5 2 0 0\",width:150},{xtype:\"label\",flex:1,html:\"Description\",margin:\"5 2 0 0\"},{xtype:\"label\",html:\"Amount",729614,51,"\",margin:\"5 2 0 2\",width:50}]},{xtype:\"tabpanel\",flex:1,scrollable:false",729831,102,"winkname:\"invoicecontainer\"",730118,36,",listeners:{activeitemchange:function(b,d,a,c){console.log(\"InvoicePanel tabpanel activeitemchange\");if(d instanceof WINK.view.JobStatusPanel){d.loadStatusOnce()}if(d===b",727635,50,"){b.up(\"InvoicePanel\")",727635,38,"header]\").show()}else{b.up(\"InvoicePanel\")",727635,38,"header]\").hide()}if(d===b",727635,33,"paymentscontainer]\")){b.up(\"InvoicePanel\").down(\"container[winkname=paymentsheader]\").show()}else{b.up(\"InvoicePanel\").down(\"container[winkname=paymentsheader]\").hide()}}},items:[{xtype:\"container\"",729831,109,"{type:\"vbox\"},scrollable:\"vertical\",iconCls:\"more\",title:\"Items Sold",729967,34,"},{xtype:\"container\"",729831,109,"{type:\"vbox\"},scrollable:\"vertical\",iconCls:\"more\",title:\"Payment(s)\",winkname:\"invoicepaymentscontainer\"},{xtype:\"jobstatuspanel\",title:\"Job Status\",iconCls:\"settings\"}]}]}]},{xtype:\"InvoiceSummary\"}]},newRxWorksheet:function(){var a",730290,54,"b=this.down(\"tabpanel\");b.setActiveItem(a",730383,239,731718,10739,"setData(b.getRange()",742484,1503,"phone",743991,41,"phone",744036,41,"phone",744081,41,"phone",744126,2799,"phone",746929,1285,"withCredentials:true,useDefaultXhrHeader:false,cors:true",748213,66,"set",748283,36,748325,581,"WINK.Utilities.setDefaultValues(b);b.set(\"patient_idpatient\",this.patient.get(\"id\"));this.patient.patientinvoices_patient_idpatient().add(b);console.log(\"New Invoice ID:\"+b.get(\"id\")",748904,59,"modelid:b.get(\"id\")",748967,44,"(b.get(\"orderdate\").getMonth()+1",749039,103,"updateInvoiceId:function(c,d){var b=d.get(\"id\");var f=this.patient.patientinvoices_patient_idpatient();var a=f.getById(c);if(a){f.remove(a)}f.add(d);var e",748826,34,"e.each(function(i,g,h){if((i.get(\"type\")===4||i.get(\"type\")===5)){if(i.get(\"modelid\")===c){i.set(\"modelid\",b)}}},this);if(!this[\"invoicePanels\"+c.toString()]){this[\"invoicePanels\"+b.toString()]=this[\"invoicePanels\"+c.toString()];this[\"invoicePanels\"+c.toString()]=null}},updateInvoiceHistoryItem:function(c,a){var b=4;if(a.get(\"delivereddate\")){b=5}c.set(\"type\",b);c.set(\"label\",a",748975,36,"(a.get(\"orderdate\").getMonth()+1)+\"-\"+a.get(\"orderdate\").getDate());c.set(\"date\",a.get(\"orderdate\"));c.set(\"modelid\",a.get(\"id\"))},invoiceSaved:function(d){var a",748826,38,"c=d.getRecord().get(\"id\");var b=d.getRecord();console.log(\"invoiceSaved:\"+c);a.each(function(g,e,f){if((g.get(\"type\")===4||g.get(\"type\")===5)&&g.get(\"modelid\")===c){this.updateInvoiceHistoryItem(g,b)}},this);a.sortHistory(",749139,47,"if(",750757,34,749281,220,"_patient_idpatient",749501,316,"_patient_idpatient",749817,265,"model",750082,66,"i,g,h){var f",748911,43,");this.updateInvoiceHistoryItem(f,i",750404,39,"openHistoryItem(a)},openHistoryItem:function(e){this.setMasked(true);var h",750507,46,"i=e.get(\"type\");var a=e.get(\"modelid",749915,36,"openHistoryItem()\"+i+\".\"+a);g.select(e,false,true);var f",750676,58,"i===0){var b",750746,123,"b=true}f",750877,36,"b",750914,36,"h)}}else{if((i===4)||(i===5)){var d=null;var b=false;if(!this[\"invoicePanels\"+a.toString()]){d",751032,59,"a.toString()]=d;b=true}else{d=this[\"invoicePanels\"+a.toString()]}f.setActiveItem(d);if(b){var c=h.patientinvoices_patient_idpatient().getById(a);this[\"invoicePanels\"+a.toString()].loadPatientInvoice(c)}",751167,1740,722432,34,"PaymentPanel\",Ext.form.Panel,{deleteItem:function(){var a=this.up(\"InvoicePanel\");a.deletePayment(this)},loadItem:function(a){this.setRecord(a)},getAmount:function(){var a=this.down(\"numberfield[name=amount]\");return a.getValue()},updateModel:function(){var b=this.getRecord();var a=this.getValues();b.set(a);return b},updateInvoiceBalance:function(){var a=this.up(\"InvoicePanel\");if(a){a.updateSummary()}},",722492,51,"5",722544,120,"datepickerfield\",required:true,margin:\"0 2 0 2\",usePicker:true,name:\"date\",width:150,style:\"borderInput\"},{xtype:\"selectfield\",required:true,margin:\"0 2 0 0\",displayField:\"name\",store:\"PaymentMethodForCurrentStor",744720,34,"width:150,",677451,37,"style:\"borderInput\"},",728386,37,723230,37,"flex:1",722880,40,"name:\"description\"},{xtype:\"price",722809,117,"0",723111,62,"-999999,name:\"amount\",listeners:{change:function(a,c,b){a.up(\"invoicepaymentpanel\").updateInvoiceBalance()}}",723580,83,",handler:function(a){a.up(\"invoicepaymentpanel\").deleteItem()}}]}},0,[\"invoicepayment",279247,40,",\"formpanel\",\"invoicepayment",620927,39,"panel:true,formpanel:true,invoicepaymentpanel:true},[\"widget.invoicepaymentpanel\"],0,[WINK.view,\"InvoicePayment",752895,50,"JobStatusWrapper\",\"BarcodeResponse\",",752944,385,",\"ProductBrowseModel\"],stores:[\"ProductStore\",",753339,134,",\"JobStatusStore\",\"PaymentMethodStore\"],views:[\"JobStatusPanel\",\"PhoneField\",\"PriceField\",\"IntField\",",753482,389,",\"AddPaymentPanel\",\"InvoicePayment",753865,113,754005,598,"Ajax.cors=true;Ext.Ajax.useDefaultXhrHeader=false;Ext.Ajax.withCredentials=true;Ext.data.proxy.Ajax.useDefaultXhrHeader=false;Ext.data.proxy.Ajax.withCredentials=true;",754599,213,"console.log(\"WINK.JSON, encode date\");",754812,190,"data.writer.Json.override({getRecordData:function(b){console.log(\"getRecordData\");var e=this,d,a,g,f=b.data;for(d=0;d<b.associations.length;d++){a=b.associations.get(d);var c=a.getName();console.log(d+\" association \"+c+\" \"+a.getType());if(a.getType()===\"hasmany\"){console.log(c+\" \"+a.getAssociationKey());f[c]=null;g=b[c]();console.log(\"child store:\"+g);g.each(function(h){console.log(\"childStore.each():\"+h);if(!f[c]){f[c]=[]}var i=this.getRecordData.call(this,h);if(h.dirty|h.phantom|(i!=null)){f[c].push(i);b.setDirty()}},e);Ext.each(g.getRemovedRecords(),function(i){if(!f[c]){f[c]=[]}i.set(\"forDeletion\",true);var h=this.getRecordData.call(this,i);f[c].push(h);b.setDirty()},e)}}if(b.dirty|b.phantom|b.get(\"forDeletion\")){return f}}})",754997,193,"window.location.reload()}});(Ext.cmd.derive(\"WINK.store.BarcodeResponseStore\",Ext.data.Store,{sortList",713281,34,"isInventory\",direction:\"ASC\"},{property:\"storeInventory\",direction:\"DESC\"},{property:\"entrepriseInventory\",direction:\"DESC\"},{property:\"fkproduct_idproduct.name\",direction:\"A",713368,42,"BarcodeRespons",713064,32,"if(!a.get(\"isInventory\")){return\"Services and Non Inventory Products\"}if(a.get(\"storeInventory\")>0){return\"Found in Current Store\"}if(a.get(\"entrepriseInventory\")>0){return\"Found in Another Store\"}return\"Not Found In Inventory\"",713721,43,"isInventory\",direction:\"ASC\"},{property:\"storeInventory\",direction:\"DESC\"},{property:\"entrepriseInventory\",direction:\"DESC\"},{property:\"fkproduct_idproduct.",712667,51,"BarcodeResponse",714475,39,755400,1227]